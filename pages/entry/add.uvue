<script>
	import { request } from '@/common/api.js';
	const UPLOAD_URL = 'https://erp.corezen.site/api/products/';

	export default {
		data() {
			return {
				loading: false, types: [{ key: 'ZJ', name: 'æ•´æœº' }, { key: 'SJ', name: 'æ•£ä»¶' }, { key: 'XS', name: 'æ˜¾ç¤ºå™¨' }, { key: 'ZX', name: 'æ‚é¡¹' }],
				form: { category: 'ZJ', supplier_id: '', name: '', cpu: '', gpu: '', ram: '', disk: '', note: '', cost_price: '', paid_amount: '', account_id: '', peer_price: '', retail_price: '' } as any,
				contacts: [], accounts: [], contactNames: ['åŠ è½½ä¸­...'], accountNames: [], currentContactName: 'è¯·é€‰æ‹©...', currentAccountName: 'é€‰æ‹©æ”¯ä»˜è´¦æˆ·',
				previewUrl: '', tempFilePath: '', showSuccess: false, showAddModal: false, 
                // ğŸŸ¢ ä¿®å¤ï¼šå¢åŠ  result.name å­—æ®µ
                result: { zencode: '', name: '', has_price: true } as any, 
                newContact: { name: '', phone: '', address: '' } as any
			}
		},
        // ... (çœç•¥ä¸­é—´ methodsï¼Œä¿æŒä¸å˜) ...
		methods: {
            // ... loadData, onContactChange ç­‰ä¿æŒä¸å˜ ...
			async submit() { 
                if (!this.form['supplier_id']) return uni.showToast({title:'å¿…é¡»é€‰ä¾›åº”å•†', icon:'none'});
                if (!this.form['cost_price']) return uni.showToast({title:'è¯·å¡«å…¥åº“æˆæœ¬', icon:'none'}); 
                if (this.showAccountSelect && !this.form['account_id']) return uni.showToast({title:'å®ä»˜å¿…é¡»é€‰è´¦æˆ·', icon:'none'});
                // è‡ªåŠ¨å‘½åé€»è¾‘åœ¨åç«¯å¤„ç†ï¼Œå‰ç«¯åªè´Ÿè´£ä¼ å‚
                this.loading = true; 
                let formData = JSON.parse(JSON.stringify(this.form));
                
                // ä¸Šä¼ é€»è¾‘ä¿æŒä¸å˜...
                try { 
                    const res = await request({ url: '/api/products/', method: 'POST', data: formData }); 
                    this.loading = false;
                    if (res) this.handleSuccess(res); 
                } catch(e) { this.loading = false; } 
            },
			handleSuccess(data: any) { 
                this.result['zencode'] = data['zencode'];
                // ğŸŸ¢ ä¿®å¤ï¼šè·å–å¹¶æ˜¾ç¤ºå•†å“åç§°
                this.result['name'] = data['name']; 
                let hasPeer = !!this.form['peer_price']; 
                let hasRetail = !!this.form['retail_price']; 
                this.result['has_price'] = hasPeer || hasRetail; 
                this.showSuccess = true;
            },
			resetForm() { 
                this.showSuccess = false; 
                // æ¸…ç©ºè¡¨å•...
                this.form = { ...this.form, name: '', cpu: '', gpu: '', ram: '', disk: '', note: '', cost_price: '', paid_amount: '' };
                this.previewUrl = ''; this.tempFilePath = ''; 
            }
		}
	}
</script>